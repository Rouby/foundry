{"name":"Use Flask","type":"chat","scope":"global","author":"aVyfPdFKbLCXovy6","img":"icons/svg/dice-target.svg","command":"const size = this.item.name.split(' ').slice(-1)[0].slice(1, -1);\n\nif (size == 'empty') {\n  ui.notifications.warn('No uses left');\n  await this.item.update({\n    data: {\n      chatFlavor: 'Nothing left in this flask.',\n      damage: { parts: [] },\n      uses: { value: 0, max: 1, per: 'charges' },\n    },\n  });\n  return;\n}\n\nconst highestHitDie = Math.max(\n  ...Object.values(this.actor.classes).map(\n    (cls) => +cls.data.data.hitDice.substr(1),\n  ),\n);\n\nconst { result } = await(new Roll(size).evaluate());\n\nlet nextSize = size;\n\nif (result == 1 || result == 2) {\n  nextSize = {\n    d20: 'd12',\n    d12: 'd10',\n    d10: 'd8',\n    d8: 'd6',\n    d6: 'd4',\n    d4: 'empty',\n  }[size];\n  ui.notifications.warn('Flask size reduced.');\n}\n\nawait this.item.update({\n  name:\n    nextSize !== size\n      ? this.item.name.replace(/d\\d+/, nextSize)\n      : this.item.name,\n  data: {\n    formula: nextSize,\n    chatFlavor:\n      nextSize !== size ? 'The contents of this flask are diminishing.' : '',\n\n    damage: {\n      parts: [\n        [],\n      ],\n    },\n    uses: { value: 1, max: 1, per: 'charges' },\n  },\n});","folder":null,"sort":0,"ownership":{"default":0,"aVyfPdFKbLCXovy6":3},"flags":{"combat-utility-belt":{"macroTrigger":""}},"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.288","createdTime":1667244175323,"modifiedTime":1667244229940,"lastModifiedBy":"aVyfPdFKbLCXovy6"},"_id":"GCjq2i6roywRpKu8"}
{"_id":"NqKZF5iHRX9tQY7S","name":"Lightning Glyph","type":"script","author":"aVyfPdFKbLCXovy6","img":"icons/svg/dice-target.svg","scope":"global","command":"new Sequence()\n    .effect()\n        .file(\"modules/JB2A_DnD5e/Library/Generic/Lightning/ElectricArc01_01_Regular_Blue_1600x500.webm\")\n        .atLocation(token)\n        .stretchTo(args[0].targets[0])\n        .duration(2000)\n        .missed(args[0].failedSaves[0] !== args[0].targets[0])\n    .sound()\n        .file(\"modules/soundfxlibrary/Combat/Single/Spell Impact Lightning/spell-impact-lightning-2.mp3\")\n        .duration(2000)\n    .play()","folder":null,"sort":0,"flags":{"combat-utility-belt":{"macroTrigger":""},"advanced-macros":{"runAsGM":false}},"ownership":{"default":0,"aVyfPdFKbLCXovy6":3},"_stats":{"systemId":null,"systemVersion":null,"coreVersion":null,"createdTime":null,"modifiedTime":null,"lastModifiedBy":null}}
{"name":"Use Healing Flask","type":"script","scope":"global","author":"aVyfPdFKbLCXovy6","img":"icons/svg/dice-target.svg","command":"const size = this.item.name.split(' ').slice(-1)[0].slice(1, -1);\n\nif (size == 'empty') {\n  ui.notifications.warn('No uses left');\n  await this.item.update({\n    data: {\n      chatFlavor: 'Nothing left in this flask.',\n      damage: { parts: [] },\n      uses: { value: 0, max: 1, per: 'charges' },\n    },\n  });\n  return;\n}\n\nconst highestHitDie = Math.max(\n  ...Object.values(this.actor.classes).map(\n    (cls) => +cls.data.data.hitDice.substr(1),\n  ),\n);\n\nconst [potionDie, potionBonus] = {\n  Lesser: [2, 2],\n  Greater: [4, 4],\n  Superior: [6, 8],\n  Supreme: [8, 16],\n}[temp1.name.split(' ')[0]];\n\nconst { result } = await(new Roll(size).evaluate());\n\nlet nextSize = size;\n\nif (result == 1 || result == 2) {\n  nextSize = {\n    d20: 'd12',\n    d12: 'd10',\n    d10: 'd8',\n    d8: 'd6',\n    d6: 'd4',\n    d4: 'empty',\n  }[size];\n  ui.notifications.warn('Flask size reduced.');\n}\n\nawait this.item.update({\n  name:\n    nextSize !== size\n      ? this.item.name.replace(/d\\d+/, nextSize)\n      : this.item.name,\n  data: {\n    formula: nextSize,\n    chatFlavor:\n      nextSize !== size ? 'The contents of this flask are diminishing.' : '',\n\n    damage: {\n      parts: [\n        [potionDie + 'd' + highestHitDie + ' + ' + potionBonus, 'healing'],\n      ],\n    },\n    uses: { value: 1, max: 1, per: 'charges' },\n  },\n});","folder":null,"sort":0,"ownership":{"default":0,"aVyfPdFKbLCXovy6":3},"flags":{"combat-utility-belt":{"macroTrigger":""}},"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.288","createdTime":1667232194871,"modifiedTime":1667236039602,"lastModifiedBy":"aVyfPdFKbLCXovy6"},"_id":"RZdYjmTX56BVNPZk"}
{"_id":"i8jjfT0PYtNGhpBx","name":"Constitution Saving Throw","type":"script","author":"aVyfPdFKbLCXovy6","img":"icons/svg/dice-target.svg","scope":"global","command":"game.MonksTokenBar.requestRoll([{\"token\":\"Sentinel\"},{\"token\":\"Grim Amakiir (Rene)\"},{\"token\":\"Matt\"},{\"token\":\"Zriss Angel\"}],{request:'save:con', dc:10, silent:false, fastForward:false, rollMode:'roll'})","folder":null,"sort":0,"flags":{"combat-utility-belt":{"macroTrigger":""},"advanced-macros":{"runAsGM":false}},"ownership":{"default":0,"aVyfPdFKbLCXovy6":3},"_stats":{"systemId":null,"systemVersion":null,"coreVersion":null,"createdTime":null,"modifiedTime":null,"lastModifiedBy":null}}
{"_id":"m2QDH38l2XSGjtv4","name":"Sneak Attack","type":"script","author":"ZA5IhNasLnkGlAxn","img":"icons/skills/melee/strike-dagger-arcane-pink.webp","scope":"global","command":"const myActor = game.actors.find((a) => a.name === \"Grim Amakiir (Rene)\");\nconst sneakAttack = myActor?.effects.find(\n  (e) => e.data.label === \"Sneak Attack\"\n);\n\nif (sneakAttack ) {\n  sneakAttack.delete();\n} else {\n  myActor.createEmbeddedDocuments(\"ActiveEffect\", [{\n    label: \"Sneak Attack\",\n    icon: \"systems/dnd5e/icons/skills/violet_27.jpg\",\n    changes: [\n      {\n        key: \"data.bonuses.weapon.damage\",\n        value: \"(ceil(@classes.rogue.levels /2))d6\",\n        mode: 0,\n      },\n    ],\n    flags: { dae: { specialDuration: [\"DamageDealt\"] } },\n    duration: {\n      combat: game.combat?._id,\n      startRound: game.combat?.round,\n      startTurn: game.combat?.turn,\n      rounds: 0,\n      turns: 1,\n    }\n  }]);\n}","folder":null,"sort":0,"flags":{"combat-utility-belt":{"macroTrigger":""}},"ownership":{"default":0,"ZA5IhNasLnkGlAxn":3},"_stats":{"systemId":null,"systemVersion":null,"coreVersion":null,"createdTime":null,"modifiedTime":null,"lastModifiedBy":null}}
